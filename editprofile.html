<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Edit Profile</title>

<!-- Roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<!-- Material Web import map + module -->
<script type="importmap">
{
  "imports": {
    "@material/web/": "https://esm.run/@material/web/"
  }
}
</script>

<script type="module">
  import '@material/web/all.js';
  import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
  document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
</script>

<style>
  /* ---------- Theme controlled by prefers-color-scheme (minimal overrides) ---------- */
  :root {
    --page-bg: #ffffff;
    --page-text: #111;
    --muted: rgba(0,0,0,0.6);
    --drawer-width: 320px;
    color-scheme: light;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --page-bg: #0b0b0b;
      --page-text: #f1f1f1;
      --muted: rgba(255,255,255,0.7);
      color-scheme: dark;
    }
  }

  /* Prevent horizontal scrolling and make layout fluid */
  html,body { height: 100%; margin: 0; overflow-x: hidden; }

  /* Top header "taped" and sticky */
  header.top-header {
    position: sticky;
    top: 8px; /* small offset to show tape */
    z-index: 60;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 1rem 0 1rem;
    pointer-events: auto;
  }

  /* hamburger button */
  #menu-btn {
    --md-sys-size: 44px;
    background: transparent;
    border-radius: 10px;
  }

  h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    margin: 0;
    display: inline-block;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    padding: 10px 14px;
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    position: relative;
  }

  body {
    background: var(--page-bg);
    color: var(--page-text);
font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0; /* no outer padding since profile becomes body */
    display: flex;
    flex-direction: column;
    align-items: stretch;
    text-align: left;
    min-height: 100vh;
    box-sizing: border-box;
    position: relative;
    overflow-y: auto; /* page scroll */
  }

  /* Side drawer styles */
  .drawer-overlay {
    position: fixed; inset: 0; z-index: 70; display: none; background: rgba(0,0,0,0.36);
  }
  .drawer-overlay.active { display: block; }

  nav.side-drawer {
    position: fixed; left: 0; top: 0; bottom: 0; width: var(--drawer-width);
    background: var(--page-bg); box-shadow: 8px 0 30px rgba(0,0,0,0.12); z-index: 80;
    transform: translateX(-110%); transition: transform 260ms cubic-bezier(.2,.9,.2,1);
    padding: 1rem 0.5rem; overflow-y: auto;
    border-top-right-radius: 12px; border-bottom-right-radius: 12px;
  }
  nav.side-drawer.open { transform: translateX(0); }

  .drawer-header { padding: 12px 16px; font-weight:600; font-size:1.1rem; }
  .drawer-list { list-style: none; margin: 0; padding: 8px; display:flex; flex-direction: column; gap: 6px; }
  .drawer-item {
    display:flex; align-items:center; justify-content: space-between; gap: 12px;
    padding: 10px 12px; border-radius: 10px; cursor: pointer;
  }
  .drawer-item:hover { background: rgba(0,0,0,0.04); }
  .drawer-item img { width:20px; height:20px; flex-shrink:0; }

  /* Main content */
  main.profile-main { width: 100%; max-width: 100%; margin: 1rem 0 3rem 0; box-sizing: border-box; padding: 0 1rem; }
  .banner { width: 100%; height: 220px; background-color: #333; background-position: center; background-size: cover; cursor: pointer; transition: filter 0.25s ease; border-radius: 12px; }
  .banner:hover { filter: brightness(0.86); }
  .profile-row { display: flex; gap: 20px; align-items: start; margin-top: 12px; flex-wrap: wrap; }
  .profile-pic { width: 120px; height: 120px; border-radius: 18px; background-color: rgba(0,0,0,0.04); background-position: center; background-size: cover; cursor: pointer; flex-shrink: 0; }
  .profile-meta { flex: 1 1 320px; min-width: 260px; }
  .name-section { display:flex; align-items:center; gap:10px; font-size:1.6rem; font-weight:600; }
  .verified-icon { width:26px; height:26px; background-image:url('/assets/verified.png'); background-size:contain; background-repeat:no-repeat; background-position:center; }
  .email { color: var(--muted); margin-top: 8px; }
  .bio-section { margin-top: 12px; color: var(--page-text); }
  #role-section { display: flex; flex-direction: column; gap: 12px; margin-top: 18px; max-width: 100%; overflow-x: hidden; }
  .role-row { display:flex; gap:12px; align-items:center; }
  .role-row img { width:32px; height:32px; flex-shrink:0; }
  .controls { margin-top: 18px; display:flex; gap:12px; flex-wrap:wrap; }

  /* Dialog overlay + animation (kept) */ .dialog-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 260ms cubic-bezier(.2,.9,.2,1); } .dialog-overlay.active { opacity: 1; pointer-events: auto; } .dialog { background: var(--page-bg); border-radius:24px; width:92%; max-width:520px; padding:1rem; transform: translateY(16px) scale(.98); opacity:0; transition: transform 260ms cubic-bezier(.2,.9,.2,1), opacity 220ms ease; } .dialog-overlay.active .dialog { transform: translateY(0) scale(1); opacity:1; } .dialog-overlay.closing { opacity:0; } .dialog-overlay.closing .dialog { transform: translateY(12px) scale(.98); opacity:0; } /* make text fields and buttons rounder and Android-like */ md-outlined-text-field, md-filled-button, md-outlined-button, md-icon-button { border-radius: 18px; /* host rounded corners */ } /* Try to style internals of md-outlined-text-field -- fallback if browser supports ::part */ md-outlined-text-field::part(input), md-outlined-text-field::part(text-field) { color: var(--page-text); border-radius: 14px; } md-outlined-text-field::part(container) { border-radius: 14px; } /* On dark theme, make text inside fields white */ @media (prefers-color-scheme: dark) { md-outlined-text-field::part(input) { color: #fff; } md-outlined-text-field { color: #fff; } }
  /* dark-field text */
  @media (prefers-color-scheme: dark) {
    md-outlined-text-field::part(input) { color: #fff; }
    md-outlined-text-field { color: #fff; }
  }

  /* responsive */
  @media (max-width:720px) { .profile-row { flex-direction: column; } .profile-pic { width: 96px; height: 96px; } .name-section { font-size: 1.25rem; } }

  /* ensure snackbar is on top visually */
  md-snackbar { z-index: 11000; }

</style>
</head>
<body>

<header class="top-header">
  <md-icon-button id="menu-btn" aria-label="Open menu">☰</md-icon-button>
  <h1 class="md-typescale-display-medium">Edit your profile</h1>
</header>

<!-- Drawer overlay + drawer -->
<div id="drawer-overlay" class="drawer-overlay" tabindex="-1" aria-hidden="true"></div>
<nav id="side-drawer" class="side-drawer" aria-hidden="true" role="navigation" aria-label="Main menu">
  <div class="drawer-header">Menu</div>
  <ul id="drawer-list" class="drawer-list">
    <!-- Items will be populated by JS for easy extension -->
  </ul>
</nav>

<main class="profile-main">
  <div class="banner" id="banner" role="button" aria-label="Edit banner"></div>

  <div class="profile-row">
    <div style="position: relative;">
      <div class="profile-pic" id="profile-pic" title="Click to edit profile picture"></div>
      <div class="profile-pic-frame" id="profile-pic-frame" style="display:none; position:absolute; inset:0; border-radius:18px; border:2px dashed rgba(0,0,0,0.12);"></div>
    </div>

    <section class="profile-meta">
      <div class="name-section">
        <span id="display-name"></span>
        <div class="verified-icon" id="verified-icon" style="display:none;" title="Verified User"></div>
        <md-icon-button id="edit-name-btn" aria-label="Edit display name">✎</md-icon-button>
      </div>

      <div class="email" id="email"></div>
      <div class="bio-section"><strong>Bio:</strong> <span id="bio-text">Loading bio...</span>
        <md-icon-button id="edit-bio-btn" aria-label="Edit bio" style="vertical-align: middle; margin-left:8px;">✎</md-icon-button>
      </div>

      <div id="website-row" style="display:none; margin-top:12px; align-items:center; gap:10px;">
        <img src="/assets/verified2.png" alt="Verified Domain" style="width:20px;height:20px;" />
        <a id="domain-link" href="#" target="_blank" style="color:inherit; text-decoration:underline;"></a>
      </div>

      <div id="domain-note" style="display:none; margin-top:8px; color:var(--muted); font-size:0.9rem;">This can only be edited or removed in the app</div>

      <div id="role-section"></div>

      <div style="margin-top:12px; display:flex; align-items:center; gap:12px;">
        <label for="publicProfileCheckbox" style="cursor:pointer;">Public Profile</label>
        <md-checkbox id="publicProfileCheckbox" aria-label="Public profile checkbox"></md-checkbox>
      </div>

      <div class="controls">
        <md-outlined-button id="view-profile-btn">View your public profile</md-outlined-button>
        <md-outlined-button id="view-profile-btn1">Manage Blocked Users</md-outlined-button>
        <md-outlined-button id="edit-frame-btn">Edit Profile Frame</md-outlined-button>
      </div>
    </section>
  </div>
</main>

<!-- Dialog (animated) -->
<div class="dialog-overlay" id="dialog-overlay" role="dialog" aria-modal="true" aria-labelledby="dialog-title">
  <div class="dialog" role="document">
    <h2 id="dialog-title">Edit</h2>
    <md-outlined-text-field id="dialog-input" label="Enter URL or text..." value=""></md-outlined-text-field>
    <div style="display:flex; gap:12px; margin-top:12px; justify-content: space-between;">
      <md-outlined-button id="dialog-cancel-btn">Cancel</md-outlined-button>
      <md-filled-button id="dialog-save-btn">Save</md-filled-button>
    </div>
  </div>
</div>

<!-- MD Snackbar -->
<md-snackbar id="snackbar"></md-snackbar>

<script type="module">
// Firebase imports (unchanged)
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCAPZF2zwU6z5rhikrIVZ4TVxf1tS5aTbA",
  authDomain: "darkpurpleof-s-website.firebaseapp.com",
  databaseURL: "https://darkpurpleof-s-website-default-rtdb.firebaseio.com",
  projectId: "darkpurpleof-s-website",
  storageBucket: "darkpurpleof-s-website.firebasestorage.app",
  messagingSenderId: "520651082420",
  appId: "1:520651082420:web:bb05c0c3fd64517952e5e1",
  measurementId: "G-S2X2JYC8Z0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// DOM elements
const menuBtn = document.getElementById('menu-btn');
const drawer = document.getElementById('side-drawer');
const drawerOverlay = document.getElementById('drawer-overlay');
const drawerList = document.getElementById('drawer-list');

const bannerEl = document.getElementById('banner');
const profilePicEl = document.getElementById('profile-pic');
const displayNameEl = document.getElementById('display-name');
const verifiedIconEl = document.getElementById('verified-icon');
const emailEl = document.getElementById('email');
const viewProfileBtn = document.getElementById('view-profile-btn');
const viewProfileBtn1 = document.getElementById('view-profile-btn1');
const editNameBtn = document.getElementById('edit-name-btn');
const websiteRow = document.getElementById('website-row');
const editFrameBtn = document.getElementById('edit-frame-btn');
const profilePicFrameEl = document.getElementById('profile-pic-frame');
const domainLink = document.getElementById('domain-link');
const domainNote = document.getElementById('domain-note');

const dialogOverlay = document.getElementById('dialog-overlay');
const dialogInput = document.getElementById('dialog-input');
const publicProfileCheckbox = document.getElementById('publicProfileCheckbox');
const dialogCancelBtn = document.getElementById('dialog-cancel-btn');
const bioTextEl = document.getElementById('bio-text');
const editBioBtn = document.getElementById('edit-bio-btn');
const dialogSaveBtn = document.getElementById('dialog-save-btn');
const snackbar = document.getElementById('snackbar');

let currentUser = null;
let editingField = null;
let currentUserFrameUrl = '';

const DEFAULT_BANNER = '/assets/default_banner.png';
const DEFAULT_PFP = 'https://darkpurpleof.github.io/org-owner.jpg';

// Drawer menu data — add more items here as needed
const MENU_ITEMS = [
  { id: 'home', label: 'Home', icon: '/assets/home.png', href: '/' }
];

function renderMenu() {
  drawerList.innerHTML = '';
  MENU_ITEMS.forEach(item => {
    const li = document.createElement('li');
    li.className = 'drawer-item';
    li.tabIndex = 0;
    li.setAttribute('role','button');
    li.innerHTML = `<span>${item.label}</span><img src="${item.icon}" alt="${item.label} icon"/>`;
    li.addEventListener('click', () => { closeDrawer(); if (item.href) window.location.href = item.href; });
    li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.click(); } });
    drawerList.appendChild(li);
  });
}

function openDrawer() {
  drawer.classList.add('open');
  drawerOverlay.classList.add('active');
  drawer.setAttribute('aria-hidden', 'false');
  drawerOverlay.setAttribute('aria-hidden', 'false');
  // trap focus to drawer (simple)
  const first = drawer.querySelector('.drawer-item');
  if (first) first.focus();
}
function closeDrawer() {
  drawer.classList.remove('open');
  drawerOverlay.classList.remove('active');
  drawer.setAttribute('aria-hidden', 'true');
  drawerOverlay.setAttribute('aria-hidden', 'true');
  menuBtn.focus();
}

menuBtn.addEventListener('click', () => { if (drawer.classList.contains('open')) closeDrawer(); else openDrawer(); });
drawerOverlay.addEventListener('click', closeDrawer);
window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && drawer.classList.contains('open')) closeDrawer(); });

renderMenu();

function openDialog(field, currentValue) {
  editingField = field;
  dialogInput.value = currentValue || '';
  dialogOverlay.classList.remove('closing');
  dialogOverlay.classList.add('active');
  setTimeout(() => {
    const inner = dialogInput.shadowRoot?.querySelector('input');
    if (inner) inner.focus();
  }, 80);
}

function closeDialog() {
  dialogOverlay.classList.add('closing');
  setTimeout(() => {
    dialogOverlay.classList.remove('active');
    dialogOverlay.classList.remove('closing');
    editingField = null;
    dialogInput.value = '';
  }, 280);
}

window.addEventListener('keydown', (e) => { if (e.key === 'Escape') { if (dialogOverlay.classList.contains('active')) closeDialog(); if (drawer.classList.contains('open')) closeDrawer(); } });

dialogCancelBtn.addEventListener('click', () => closeDialog());
dialogOverlay.addEventListener('click', (e) => { if (e.target === dialogOverlay) closeDialog(); });

// Save handler
dialogSaveBtn.addEventListener('click', async () => {
  if (!currentUser) { showToast('No user logged in', 3500); return; }
  const newValue = (dialogInput.value || '').trim();
  if (newValue === '') { showToast('Value cannot be empty', 3500); return; }
  const userDocRef = doc(db, 'user_data', currentUser.email);
  try {
    const updateObj = {};
    if (editingField === 'display_name') updateObj['display name'] = newValue; else updateObj[editingField] = newValue;
    await setDoc(userDocRef, updateObj, { merge: true });

    if (editingField === 'banner') bannerEl.style.backgroundImage = `url(${newValue})`;
    else if (editingField === 'profile_picture') profilePicEl.style.backgroundImage = `url(${newValue})`;
    else if (editingField === 'display_name') displayNameEl.textContent = newValue;
    else if (editingField === 'bio') bioTextEl.textContent = newValue || 'Bio not yet set';
    else if (editingField === 'profile_picture_frame') {
      currentUserFrameUrl = newValue;
      if (newValue && newValue.trim() !== '') { profilePicFrameEl.style.backgroundImage = `url(${newValue})`; profilePicFrameEl.style.display = 'block'; }
      else { profilePicFrameEl.style.backgroundImage = ''; profilePicFrameEl.style.display = 'none'; }
    }

    showToast('Saved successfully!', 3000);
    closeDialog();
    setTimeout(() => location.reload(), 1100);
  } catch (err) {
    showToast('Failed to save: ' + (err?.message || err), 4500);
  }
});

async function loadUserData(user) {
  if (!user) return;
  currentUser = user;
  emailEl.textContent = user.email;
  viewProfileBtn.dataset.href = `/viewprofile?profile=${encodeURIComponent(user.email)}`;
  viewProfileBtn1.dataset.href = `/manageblockedusers`;

  const userDocRef = doc(db, 'user_data', user.email);
  const userDocSnap = await getDoc(userDocRef);

  let bannerUrl = DEFAULT_BANNER;
  let isProfilePublic = false;
  let pfpUrl = DEFAULT_PFP;
  let displayName = user.email;
  let isVerified = false;
  let bio = 'Bio not yet set';
  let frameUrl = '';
  websiteRow.style.display = 'none';
  domainNote.style.display = 'none';
  let purchasedIds = [];

  if (userDocSnap.exists()) {
    const data = userDocSnap.data();
    if (data.banner) bannerUrl = data.banner;
    if (data.profile_picture) pfpUrl = data.profile_picture;
    if (data['display name']) displayName = data['display name'];
    if (data.bio && data.bio.trim() !== '') bio = data.bio;
    if (data.isProfilePublic === true) isProfilePublic = true;
    if (data.is_verified === true) isVerified = true;
    if (data.purchasedIds && Array.isArray(data.purchasedIds)) purchasedIds = data.purchasedIds;
    if (data['profile_picture_frame']) frameUrl = data['profile_picture_frame'];
    if (data.domain_verified === true && typeof data.domain_name === 'string' && data.domain_name.trim() !== '') {
      domainLink.href = data.domain_name.startsWith('http') ? data.domain_name : 'https://' + data.domain_name;
      domainLink.textContent = data.domain_name;
      websiteRow.style.display = 'flex';
    } else domainNote.style.display = 'block';

    if (purchasedIds.includes('PFPFRAMES')) editFrameBtn.style.display = 'inline-flex'; else editFrameBtn.style.display = 'none';

    const roleSection = document.getElementById('role-section');
    const roles = data.roles && Array.isArray(data.roles) && data.roles.length > 0 ? data.roles : ['Member'];
    const roleMap = { "Administrator": { icon: "/assets/ic_admin.webp", desc: "Official Administrator of the platform, can manage users" }, "Member": { icon: "/assets/ic_member.webp", desc: "Normal member of the platform" }, "(Creator) English": { icon: "/assets/us.png", desc: "Helped translate the app into English, creator of the app!" }, "German helper": { icon: "/assets/de.png", desc: "User who translated the app into German" }, "Spanish Helper": { icon: "/assets/es.png", desc: "User who translated the app into Spanish" }, "Japanese Helper": { icon: "/assets/jp.png", desc: "User who translated the app into Japanese" }, "Russian Helper": { icon: "/assets/ru.png", desc: "User who translated the app into Russian" }, "Owner": { icon: "/assets/ic_owner.webp", desc: "The owner of the DarkPurpleOF's website!, official account, it's me DarkPurple!" }, "Tester": { icon: "/assets/test.png", desc: "User who tested the app before its official release" }, "Legacy User": { icon: "/assets/legacy.png", desc: "Users registered on the platform prior to December 2024" }, "System": { icon: "/assets/ic_system.webp", desc: "Official system account!" }, "Elite User": { icon: "/assets/elite.png", desc: "Users whose actions or contributions have been deeply known in the platform" }, "Feedback Contributor": { icon: "/assets/feedback.png", desc: "Users whose contributions or ideas have been added to the app or website" }, "Unbannable": { icon: "/assets/ic_unbannable.webp", desc: "Users who can't be banned by moderation tools or the system" } };
    const importantRoles = roles.filter(role => roleMap && roleMap.hasOwnProperty && roleMap.hasOwnProperty(role));
    if (importantRoles.length > 0) {
      roleSection.innerHTML = '';
      importantRoles.forEach(role => {
        const { icon, desc } = roleMap[role];
        const row = document.createElement('div');
        row.className = 'role-row';
        row.innerHTML = `\n          <img src="${icon}" alt="${role}" />\n          <div style="display:flex;flex-direction:column;">\n            <strong style="font-size:1em;color:var(--page-text)">${role}</strong>\n            <span style="font-size:0.9em;opacity:0.8">${desc}</span>\n          </div>\n        `;
        roleSection.appendChild(row);
      });
      if (roles.length > importantRoles.length) {
        const note = document.createElement('div');
        note.style.marginTop = '8px'; note.style.fontSize = '0.9rem'; note.style.opacity = '0.6'; note.textContent = `Other roles can be viewed in the app.`;
        roleSection.appendChild(note);
      }
    }
  }

  bannerEl.style.backgroundImage = `url(${bannerUrl})`;
  profilePicEl.style.backgroundImage = `url(${pfpUrl})`;
  displayNameEl.textContent = displayName;
  verifiedIconEl.style.display = isVerified ? 'inline-block' : 'none';
  bioTextEl.textContent = bio;
  if (publicProfileCheckbox) publicProfileCheckbox.checked = isProfilePublic;
  currentUserFrameUrl = frameUrl;
  if (frameUrl && frameUrl.trim() !== '') { profilePicFrameEl.style.backgroundImage = `url(${frameUrl})`; profilePicFrameEl.style.display = 'block'; }
  else { profilePicFrameEl.style.backgroundImage = ''; profilePicFrameEl.style.display = 'none'; }
}

// Event wiring
bannerEl.addEventListener('click', () => { const bg = bannerEl.style.backgroundImage || ''; openDialog('banner', bg.startsWith('url(') ? bg.slice(5, -2) : bg); });
profilePicEl.addEventListener('click', () => { const bg = profilePicEl.style.backgroundImage || ''; openDialog('profile_picture', bg.startsWith('url(') ? bg.slice(5, -2) : bg); });
editNameBtn.addEventListener('click', () => openDialog('display_name', displayNameEl.textContent));
editBioBtn.addEventListener('click', () => openDialog('bio', bioTextEl.textContent === 'Bio not yet set' ? '' : bioTextEl.textContent));

publicProfileCheckbox.addEventListener('change', async () => { if (!currentUser) return; const newVal = publicProfileCheckbox.checked; const userDocRef = doc(db, 'user_data', currentUser.email); try { await setDoc(userDocRef, { isProfilePublic: newVal }, { merge: true }); showToast('Saved successfully!', 2500); } catch (err) { showToast('Failed to update Public Profile setting: ' + (err?.message||err), 4500); publicProfileCheckbox.checked = !newVal; } });

editFrameBtn.addEventListener('click', () => openDialog('profile_picture_frame', currentUserFrameUrl));
viewProfileBtn.addEventListener('click', () => { const href = viewProfileBtn.dataset.href; if (href) window.location.href = href; });
viewProfileBtn1.addEventListener('click', () => { const href = viewProfileBtn1.dataset.href; if (href) window.location.href = href; });

onAuthStateChanged(auth, user => { if (user) loadUserData(user); else window.location.href = '/login.html'; });

// Snackbar helper (fallback included)
function showToast(message, duration = 3500) {
  if (!snackbar) { showFallbackSnackbar(message, duration); return; }
  try {
    snackbar.labelText = message; snackbar.timeoutMs = duration; if (typeof snackbar.open === 'function') snackbar.open(); else if (typeof snackbar.show === 'function') snackbar.show(); else showFallbackSnackbar(message, duration);
  } catch (e) { showFallbackSnackbar(message, duration); }
}
function showFallbackSnackbar(message, duration) {
  const el = document.createElement('div'); el.textContent = message; Object.assign(el.style, { position: 'fixed', left: '50%', transform: 'translateX(-50%)', bottom: '24px', background: 'rgba(0,0,0,0.85)', color: '#fff', padding: '12px 18px', borderRadius: '12px', zIndex: '12000', boxShadow: '0 6px 18px rgba(0,0,0,0.4)', opacity: '0', transition: 'opacity 200ms ease, transform 200ms ease' }); document.body.appendChild(el); requestAnimationFrame(() => { el.style.opacity = '1'; el.style.transform = 'translateX(-50%) translateY(-6px)'; }); setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateX(-50%) translateY(0)'; setTimeout(() => el.remove(), 220); }, duration);
}

// render drawer menu on load
renderMenu();

</script>
</body>
</html>
